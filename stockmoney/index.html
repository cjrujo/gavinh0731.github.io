<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Stock your money</title>

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="freeze_table.css">
    <link rel="stylesheet" href="color.css">
    
  </head>
  <body>
    <div id="app">
      <vue-bootstrap4-table
        :rows="rows"
        :columns="columns"
        :actions="actions"
        :config="config"
        @on-columns="onColumes"
      >
        <!-- 排序 -->
        <template slot="sort-asc-icon">
          ▲
        </template>
        <template slot="sort-desc-icon">
          ▼
        </template>
        <template slot="no-sort-icon">
          <span style="opacity: 50%;">▲▼</span>
        </template>
        
        

        <!-- 分頁說明 -->
        <template slot="pagination-info" slot-scope="props">
          此頁筆數：{{props.currentPageRowsLength}} |
          篩選筆數：{{props.filteredRowsLength}} | 總筆數：
          {{props.originalRowsLength}}
        </template>
        <template slot="refresh-button-text">
          <i class="fas fa-sync-alt"></i> ⚡️&nbsp;&nbsp;更新畫面
        </template>
        <template slot="reset-button-text">
          <i class="fas fa-broom"></i> ✍️&nbsp;&nbsp;重新設定
        </template>

        <!-- 各表格顏色定義 -->
        <template slot="b_info_code" slot-scope="props">
          <a target="_blank" v-bind:href="'https://goodinfo.tw/StockInfo/StockDetail.asp?STOCK_ID=' + props.cell_value" >{{props.cell_value}}</a>
        </template>

        <template slot="b_info_change" slot-scope="props">
          <span class="red" v-if="parseFloat(props.cell_value) > 0">{{props.cell_value}}</span>
          <span class="green" v-else>{{props.cell_value}}</span>
        </template>
        <template slot="b_info_percentage" slot-scope="props">
          <span class="red" v-if="parseFloat(props.cell_value) > 0">{{props.cell_value}}</span>
          <span class="green" v-else>{{props.cell_value}}</span>
        </template>

        
      </vue-bootstrap4-table>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.22/dist/vue.js"></script>
    <script
      src="https://unpkg.com/vue-bootstrap4-table@1.0.21/dist/vue-bootstrap4-table.min.js"
      crossorigin="anonymous"
    ></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js'></script>
    <!-- <script src="./columns.js"></script> -->
    <!-- <script src="./rows.js"></script> -->
    <script>
      new Vue({
        el: '#app',
        data: {
          rows: [],
          columns: [],
          config: {
            //checkbox_rows: true,
            //rows_selectable: true,
            card_title: 'Vue Bootstrap 4 advanced 表格',
            highlight_row_hover_color: "#f8e9ac",
            //multi_column_sort: true, // default false
            pagination: true, // default true
            pagination_info: true, // default true
            num_of_visibile_pagination_buttons: 7, // default 5
            per_page: 10, // default 10
            per_page_options: [10, 20, 30, 50, 3000],
          },
          actions: [
            {
              btn_text: '公司基本資料',
              event_name: 'on-columns',
              class: 'btn btn-primary my-custom-class',
              event_payload: {
                msg: 'json/basic_info_cols.json',
              },
            },
            {
              btn_text: '獲利能力_歷年加權平均',
              event_name: 'on-columns',
              class: 'btn btn-primary my-custom-class',
              event_payload: {
                msg: 'json/basic_eps_cols.json',
              },
            },
          ],
        },
        mounted(){
          PAGE_COUNT = 2;
          this['page_count'] = 0;
          this['row_count'] = 0;
          // this.rows = rows
          axios.get('json/basic_info.json')
            //.then(response => (this.rows = response.data))
            .then(response => {
              for (i = 0; i < response.data.length; i++) {
                this['row'+i] = {};
                this['row'+i]["b_info"] = response.data[i]["b_info"];
                this['row_count'] = this['row_count'] + 1;
              }
              //console.log("cccc", this['row_count'])
              this['page_count'] = this['page_count'] + 1;

              //=== === load rows === ===
              if (this['page_count'] == PAGE_COUNT) {
                for (i = 0; i < this['row_count']; i++) {
                //for (i = 0; i < 18; i++) {
                  this.rows.push(this['row'+i]);
                }
              }
            })
            .catch(function (error) { // 请求失败处理
              console.log(error);
            });

          axios.get('json/basic_eps.json')
            //.then(response => (this.rows = response.data))
            .then(response => {
              for (i = 0; i < response.data.length; i++) {
                this['row'+i]["b_eps"] = response.data[i]["b_eps"];
              }
              //console.log("bbbb", this['row_count'])
              this['page_count'] = this['page_count'] + 1;

              //=== === load rows === ===
              if (this['page_count'] == PAGE_COUNT) {
                for (i = 0; i < this['row_count']; i++) {
                //for (i = 0; i < 18; i++) {
                  this.rows.push(this['row'+i]);
                }
              }
            })
            .catch(function (error) { // 请求失败处理
              console.log(error);
            });

          // this.columns
          axios.get('json/basic_info_cols.json')
            .then(response => {
              //console.log("aaaa", this['row_count'])
              //=== === load rows === ===
              if (this['page_count'] == PAGE_COUNT) {
                for (i = 0; i < this['row_count']; i++) {
                //for (i = 0; i < 18; i++) {
                  this.rows.push(this['row'+i]);
                }
              }
              
              //------------------------------
              this.columns = response.data;
            })
            .catch(function (error) { // 请求失败处理
              console.log(error);
            });
        },

        methods: {
          onColumes(payload) {
            console.log(payload.msg)
            axios.get(payload.msg)
              //.then(response => (this.columns = response.data))
              .then(response => {
                this.columns = response.data;
              })
              .catch(function (error) { // 请求失败处理
                console.log(error);
              });
          },
        },
      })
    </script>
  </body>
</html>
